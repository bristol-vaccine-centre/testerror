<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Uses apparent prevalence, and uncertain
estimates of test sensitivity and test specificity for the 3 methods
described in Supplementary 2. This function works for a single panel per
dataframe, multiple panels will need to call this function multiple times
in a group_modify."><title>Calculate an estimate of true prevalence for a single panel and components — true_panel_prevalence • testerror</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate an estimate of true prevalence for a single panel and components — true_panel_prevalence"><meta property="og:description" content="Uses apparent prevalence, and uncertain
estimates of test sensitivity and test specificity for the 3 methods
described in Supplementary 2. This function works for a single panel per
dataframe, multiple panels will need to call this function multiple times
in a group_modify."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">testerror</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/testerror.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/bayesian-panel-tests.html">Bayesian adjustment of panel test error</a>
    <a class="dropdown-item" href="../articles/beta-distributions.html">Working with Beta distributions</a>
    <a class="dropdown-item" href="../articles/panel-tests.html">Panel test error adjustment</a>
    <a class="dropdown-item" href="../articles/single-test.html">Single test error adjustment</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bristol-vaccine-centre/testerror/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Calculate an estimate of true prevalence for a single panel and components</h1>
      <small class="dont-index">Source: <a href="https://github.com/bristol-vaccine-centre/testerror/blob/HEAD/R/true_panel_prevalence.R" class="external-link"><code>R/true_panel_prevalence.R</code></a></small>
      <div class="d-none name"><code>true_panel_prevalence.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Uses apparent prevalence, and uncertain
estimates of test sensitivity and test specificity for the 3 methods
described in Supplementary 2. This function works for a single panel per
dataframe, multiple panels will need to call this function multiple times
in a <code>group_modify</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">true_panel_prevalence</span><span class="op">(</span></span>
<span>  test_results <span class="op">=</span> <span class="fu">testerror</span><span class="fu">::</span><span class="va"><a href="dot-input_data.html">.input_data</a></span>,</span>
<span>  false_pos_controls <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_controls <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  false_neg_diseased <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_diseased <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  sens <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spec <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  panel_name <span class="op">=</span> <span class="st">"Panel"</span>,</span>
<span>  confint <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rogan-gladen"</span>, <span class="st">"lang-reiczigel"</span>, <span class="st">"bayes"</span><span class="op">)</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>test_results</dt>
<dd><p>A dataframe containing the following columns:</p><ul><li><p>id (character) - the patient identifier</p></li>
<li><p>result (logical) - the test result</p></li>
<li><p>test (factor) - the test type</p></li>
</ul><p>Ungrouped</p></dd>


<dt>false_pos_controls</dt>
<dd><p>the number of positives that appeared in the specificity
disease-free control group. These are by definition false positives. This
is (1-specificity)*n_controls</p></dd>


<dt>n_controls</dt>
<dd><p>the number of controls in the specificity
disease-free control group.</p></dd>


<dt>false_neg_diseased</dt>
<dd><p>the number of negatives that appeared in the sensitivity
confirmed disease group. These are by definition false negatives. This
is (1-sensitivity)*n_diseased</p></dd>


<dt>n_diseased</dt>
<dd><p>the number of confirmed disease cases in the sensitivity
control group.</p></dd>


<dt>...</dt>
<dd><p>Arguments passed on to <code><a href="uncertain_panel_rogan_gladen.html">uncertain_panel_rogan_gladen</a></code>, <code><a href="prevalence_panel_lang_reiczigel.html">prevalence_panel_lang_reiczigel</a></code>, <code><a href="bayesian_panel_complex_model.html">bayesian_panel_complex_model</a></code>, <code><a href="bayesian_panel_true_prevalence_model.html">bayesian_panel_true_prevalence_model</a></code>, <code><a href="bayesian_panel_simpler_model.html">bayesian_panel_simpler_model</a></code>, <code><a href="bayesian_panel_logit_model.html">bayesian_panel_logit_model</a></code></p><dl><dt><code>samples</code></dt>
<dd><p>number fo random draws of sensitivity and specificity</p></dd>

    <dt><code>fmt</code></dt>
<dd><p>a <code>sprintf</code> formatting string accepting 3 numbers</p></dd>

    <dt><code>panel_sens</code></dt>
<dd><p>the prior sensitivity of the panel as a <code>beta_dist</code>
(optional)</p></dd>

    <dt><code>panel_spec</code></dt>
<dd><p>the prior specificity of the panel as a <code>beta_dist</code>
(optional)</p></dd>

    <dt><code>cache_result</code></dt>
<dd><p>save the result of the sampling in memory for the current
session</p></dd>

    <dt><code>chains</code></dt>
<dd><p>A positive integer specifying the number of Markov chains. 
    The default is 4.</p></dd>

    <dt><code>iter</code></dt>
<dd><p>A positive integer specifying the number of iterations for each 
    chain (including warmup). The default is 2000.</p></dd>

    <dt><code>warmup</code></dt>
<dd><p>A positive integer specifying the number of warmup (aka burnin)
    iterations per chain. If step-size adaptation is on (which it is by default), 
    this also controls the number of iterations for which adaptation is run (and
    hence these warmup samples should not be used for inference). The number of 
    warmup iterations should be smaller than <code>iter</code> and the default is
    <code>iter/2</code>.</p></dd>

    <dt><code>model_type</code></dt>
<dd><p>The bayesian model used - one of: <code>logit</code>, <code>simpler</code>, <code>complex</code>; default <code>logit</code></p></dd>

  
</dl></dd>


<dt>sens</dt>
<dd><p>the prior sensitivity of the test as a <code>beta_dist</code>.</p></dd>


<dt>spec</dt>
<dd><p>the prior specificity of the test as a <code>beta_dist</code>.</p></dd>


<dt>panel_name</dt>
<dd><p>the name of the panel for combined result</p></dd>


<dt>confint</dt>
<dd><p>confidence interval limits</p></dd>


<dt>method</dt>
<dd><p>one of:</p><ul><li><p>"lang-reiczigel": Frequentist confidence limits</p></li>
<li><p>"bayes": Bayesian analysis</p></li>
<li><p>"rogan-gladen": Rogan gladen with uncertainty</p></li>
</ul></dd>


<dt>na.rm</dt>
<dd><p>exclude patients with missing results</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A dataframe containing the following columns:</p><ul><li><p>prevalence.label (character) - a fomatted label of the true prevalence estimate with CI</p></li>
<li><p>prevalence.lower (numeric) - the lower estimate</p></li>
<li><p>prevalence.median (numeric) - the median estimate</p></li>
<li><p>prevalence.method (character) - the method of estimation</p></li>
<li><p>prevalence.upper (numeric) - the upper estimate</p></li>
<li><p>test (character) - the name of the test or panel</p></li>
</ul><p>Ungrouped</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">tmp</span> <span class="op">=</span> <span class="fu">testerror</span><span class="fu">:::</span><span class="fu">panel_example</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">true_panel_prevalence</span><span class="op">(</span></span></span>
<span class="r-in"><span>  test_results <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">samples</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>,<span class="va">test</span>,result <span class="op">=</span> <span class="va">observed</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  false_pos_controls <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">performance</span><span class="op">$</span><span class="va">false_pos_controls</span>,</span></span>
<span class="r-in"><span>  n_controls <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">performance</span><span class="op">$</span><span class="va">n_controls</span>,</span></span>
<span class="r-in"><span>  false_neg_diseased <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">performance</span><span class="op">$</span><span class="va">false_neg_diseased</span>,</span></span>
<span class="r-in"><span>  n_diseased <span class="op">=</span> <span class="va">tmp</span><span class="op">$</span><span class="va">performance</span><span class="op">$</span><span class="va">n_diseased</span>,</span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"rogan-gladen"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>qbeta(a, *) =: x0 with |pbeta(x0,*) - alpha| = 0.06217 is not accurate</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>qbeta(a, *) =: x0 with |pbeta(x0,*) - alpha| = 0.06217 is not accurate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 11 × 16</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    prevalence.median prevalence.lower prevalence.upper prevalence.label     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>           0.010<span style="text-decoration: underline;">2</span>           0.003<span style="text-decoration: underline;">77</span>          0.014<span style="text-decoration: underline;">4</span>  1.02% [0.38% — 1.44%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>           0.005<span style="text-decoration: underline;">80</span>          0                0.009<span style="text-decoration: underline;">42</span> 0.58% [0.00% — 0.94%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>           0.014<span style="text-decoration: underline;">2</span>           0.006<span style="text-decoration: underline;">21</span>          0.020<span style="text-decoration: underline;">2</span>  1.42% [0.62% — 2.02%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>           0.005<span style="text-decoration: underline;">24</span>          0                0.009<span style="text-decoration: underline;">97</span> 0.52% [0.00% — 1.00%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>           0.007<span style="text-decoration: underline;">99</span>          0                0.015<span style="text-decoration: underline;">8</span>  0.80% [0.00% — 1.58%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>           0.009<span style="text-decoration: underline;">57</span>          0                0.016<span style="text-decoration: underline;">0</span>  0.96% [0.00% — 1.60%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>           0                0                0.005<span style="text-decoration: underline;">32</span> 0.00% [0.00% — 0.53%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>           0.015<span style="text-decoration: underline;">2</span>           0.005<span style="text-decoration: underline;">30</span>          0.022<span style="text-decoration: underline;">1</span>  1.52% [0.53% — 2.21%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>           0.018<span style="text-decoration: underline;">4</span>           0.017<span style="text-decoration: underline;">2</span>           0.021<span style="text-decoration: underline;">1</span>  1.84% [1.72% — 2.11%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>           0.001<span style="text-decoration: underline;">34</span>          0.001<span style="text-decoration: underline;">10</span>          0.001<span style="text-decoration: underline;">75</span> 0.13% [0.11% — 0.17%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span>           0.079<span style="text-decoration: underline;">4</span>           0.061<span style="text-decoration: underline;">5</span>           0.097<span style="text-decoration: underline;">6</span>  7.94% [6.15% — 9.76%]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 12 more variables: spec.median &lt;dbl&gt;, spec.lower &lt;dbl&gt;, spec.upper &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   spec.label &lt;chr&gt;, sens.median &lt;dbl&gt;, sens.lower &lt;dbl&gt;, sens.upper &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   sens.label &lt;chr&gt;, prevalence.method &lt;chr&gt;, test &lt;chr&gt;, pos_obs &lt;int&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   n_obs &lt;int&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

